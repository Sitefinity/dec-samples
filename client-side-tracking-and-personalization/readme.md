## Overview
The purpose of this application is to demonstrate how you can use the [Progress Sitefinity Digital Experience Cloud JavaScript SDK](http://docs.sitefinity.com/dec/leverage-the-javascript-sdk-to-capture-client-side-behavior) (version [1.2.2](https://dec.azureedge.net/sdk/telerik-dec-client.min.1.2.2.js) for personalizing a web application. The UI is developed within the context of the Bootstrap framework (Narrow Jumbotron Template) with simple HTML and JavaScript. The application has a simple structure and revolves around 3 key types of personalization - by persona, by campaign, and by lead score.

## DEC SDK Initialization
To start working with the DEC JavaScript SDK, you fisrt need to create an instance with an options object that contains the following information:
- **source** - represents the data source, from which the specific data center collects data. For the requirements of this sample scenario, this is *QuantumDecDemo*, which identifies the data collected by this demo application.
- **subjectKey** - represents the subject that is used in each data collection call or personalization call. In most cases, this is the user ID. If you leave out this parameter, the JavaScript SDK auto-generates the key.
**NOTE: DEC will recognise and map contacts that have the emails but different user IDs. The same applies if contacts have the same user IDs but different emails.
- **apiKey** - the API key associated with the data center that collects the data. 
- **authToken** - passed as Authorization header. This token is intended to be used by an application, so it can authorize it to communicate with the personalization end points. You can create such a token in the DEC Administration dashboard of your data center by navigating to "Authorized application". Next, concatenate "appauth " string with the generated access token, for example: "appauth 97e8b2d2-93ce-cd01-b47b-076a201eab11".
- **trackPageVisits** - indicates whether out-of-the-box tracking of page visits is used.
- **instrument** - indicates whether HTML5 instrumentation is used.

##### Example:
```javascript
var decClient = new sfDataIntell.Client({
    source: 'QuantumDecDemo',
    subjectKey: '89071fdf-baf0-4d7a-80d2-02113b40a08c', // or leave empty to auto-generate id
    apiKey: 'f1b2f31b-eab7-475d-82ba-2135c7ab7a7e',
    authToken: 'appauth 89071fdf-baf0-4d7a-80d2-02113b40a08c',
    trackPageVisits: true,
    instrument: true
});
```
**NOTE:** _If HTML Instrumentation is turned on (```instrument: true```), you need to execute the initialization script after the page body is rendered!_

#### Additional setup
To properly test the personalization functionality, you need to also configure the following:
1. "Submit form data" button - simulates submitting of form data, then embedded in an interaction and sent to DEC. You can see this function in the code and can optionally modify the subject metadata to test different scenarios, for example submitting user names and email:
###### Example:
```javascript
var submitFormData = function () {
    var subjectMetadata = {
        'FirstName': 'John',
        'LastName': 'Doe',
        'Email': 'john.doe@progress.com'
    };
    decClient.subjectMetadataClient.writeSubjectMetadata(subjectMetadata);
};
```
2. "Delete cookie" button - deletes the cookie set by the JavaScript SDK. The cookie keeps a contact's **subjectKey**. If you are not using aspecific **subjectKey** and it is auto-generated by the JavaScript SDK, you need to delete the cookie, so that you can complete the demo as another user.

## DEC configuration
To enable the demo application to work, you need to configure in the data center a number of scoring models for reporting, such as personas defintion, lead scoring, conversion tracking, campaign defintion.

#### Persona
1. Create a "Dev user" Persona with a 50 point threshold.
2. Add a rule "Visit Dev documentation page"(If contacts... "Visit" -> exact match "Dev documentation page") and give 50 points for this persona for visiting the page, that is, set the rule to "once".
3. From the URL string, copy the persona ID, so that you can later use it when personalizing the site, based on a specific persona.

#### Lead scoring
1. Create a lead scoring type with the name "Demo".
2. Add 3 stages.
   1. Stage 1, named "Cold leads" and with a threshold of 1 point.
   1. Stage 2, named "Engaged leads" and with a threshold of 10 points.
   1. Stage 3, named "Hot leads" and with a threshold of 100 points.
3. Define the rules and the the amount of points that interactions contribute to each lead scoring starge.
   1. Add rule "Register Account"(If contacts... "Register" -> exact match "Account") and give 1 point to contacts for completing the interaction "once".
   1. Add rule "Visit Product page"(If contacts... "Visit" -> exact match "Product page") and give 10 points to contacts for completing the interaction "once".
   1. Add rule "Download file Product"(If contacts... "Download file" -> exact match "Product") and give 100 points to contacts for completing the interaction "once".
4. From the URL string, copy the lead scoring Id, so that you can later use it when personalizing the site, based on lead scores of visitors.

#### Conversion tracking (needed for campaign definition)
1. Define a conversion report and name it "Download product demo".
2. Select an interaction that defines the conversion - "Download file Demo"(created in a similar manner as the scoring rules in the steps above).
3. Create the conversion.

#### Campaign
1. Create a campaign with name "Download demo by registered users".
2. Select a conversion to optimize - the "Download product demo" conversion.
3. Go to the *Engage the audience* step and from the *Advanced* menu, create a "Visit Demo page" interaction (created in a similar manner as the scoring rules in the steps above).
4. Narrow the audience by behavior by selecting "Interacted with..." From the Advanced menu, create a "Register User" interaction (created in a similar manner as the scoring rules in the steps above).
5. From the URL string, copy the campaign ID, so that you can later use it when personalizing the site, based on a specific campaign.

## Tracking
The JavaScript SDK automatically tracks page visits. To track custom interactions for the purposes of this demo sample, you use HTML5 instrumentation. For more information about the ways you can use HTML5 instrumentation to track the audience of your site, see [Leverage the JavaScript SDK to capture client side behavior](https://docs.sitefinity.com/dec/api-v2/for-developers-leverage-the-javascript-sdk-to-capture-client-side-behavior).

## Personalization
The UI has three tabs, each with specific personalization purposes. You can find the code at the bottom of the HTML file. The setup should call the 3 functions every second and accordingly update the personalized area. After setting up personalization, you can simulate different actions and interactions and see the result of these actions in the specified page area.
The JavaScript SDK provides a functionality for personalization by:
- [persona](http://docs.sitefinity.com/dec/personas-profile-your-audience) - Use **personalizationClient.isInPersonas(scoringIds, doneCallback, failCallback, subjectKey)** method. Returns a list of ScoringResults describing the threshold, score and scoringId.
- [campaign](http://docs.sitefinity.com/dec/campaigns-define-and-track) - Use **personalizationClient.isInCampaigns(campaignIds, doneCallback, failCallback)** method. Returns a collection of objects indicating whether the client is in the requested campaigns.
- [lead scoring](http://docs.sitefinity.com/dec/lead-scoring-align-marketing-and-sales) - Use the new **v2.personalizationClient.isInLeads(scoringIds, doneCallback, failCallback, subjectKey)** method. Based on a collection of clients data-sources and subjects and collection of leads ids, it return information on whether a given client has scored or passed any level for each of the specified leads.

## Additional information about working with Digital Experience Cloud JavaScript SDK personalization client
Take a look at [this wiki article](https://github.com/Sitefinity/dec-samples/wiki/DEC-JS-SDK-Personalization-Client).
