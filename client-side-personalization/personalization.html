<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Progress Sitefinity Digital Experience Cloud SDK for JavaScript</title>

    <!-- Bootstrap core CSS -->
    <link href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom styles for this template -->
    <link href="jumbotron-narrow.css" rel="stylesheet">
    <!-- jQuery core js -->
    <script src="http://code.jquery.com/jquery-1.11.3.js" type="text/javascript"></script>
    <!-- Bootstrap core js -->
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>

    <script src="https://dec.azureedge.net/sdk/telerik-dec-client.min.1.2.2.js" type="text/javascript"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>

<div class="container">
    <div class="jumbotron">
        <h1>Custom Personalization</h1>
        <p class="lead"><a href="http://www.sitefinity.com/digital-experience-cloud">Progress Sitefinity Digital Experience Cloud</a> SDK
            for JavaScript</p>
    </div>

    <h3>You can personalize your page by the following criteria: </h3>
    <ul class="nav nav-tabs">
        <li class="active"><a data-toggle="tab" href="#persona">By Persona</a></li>
        <li><a data-toggle="tab" href="#campaign">By Campaign</a></li>
        <li><a data-toggle="tab" href="#lead">By Lead</a></li>
    </ul>

    <div class="tab-content">
        <div id="persona" class="by-persona tab-pane fade in active row">
            <div class="col-sm-6">
                <div class="col-sm-12">
                    <p>Use the following button to simulate <b>"Visit Dev documentation page"</b> Interaction and contribute 60 points to the <b>"Dev user"</b> Persona</p>
                </div>
                <div class="col-sm-12">
                    <a id="btn-touchpoint-persona" class="btn btn-lg btn-info" href="#" role="button"
                        sfdi-trigger="click" sfdi-predicate="Visit" sfdi-object="Dev documentation page">
                        Simulate action
                    </a>
                </div>
            </div>
            <div class="col-sm-6">
                <h4>Personalized Area by Persona</h4>
                <div class="result-content">
                    <h4 class="result-header">Result</h4>

                    <h3 id="in-persona">You are recognized as a <b>Dev user</b> Persona</h3>
                    <h3 id="not-in-persona">You are <b>NOT</b> recognized as a Dev user Persona</h3>
                </div>
            </div>
        </div>

        <div id="campaign" class="by-campaign tab-pane fade row">
            <div class="col-sm-6 campaign-conversion">
                <p>Use the following button to simulate a <b>"Register User"</b> interaction which will make you targeted by <b>"Download demo by registered users"</b> campaign.</p>
                <a id="btn-campaign-conversion" class="btn btn-lg btn-info col" href="#" role="button"
                   sfdi-trigger="click" sfdi-predicate="Register" sfdi-object="User">
                    Simulate action
                </a>
            </div>
            <div class="col-sm-6">
                <div class="col-sm-12">
                    <h4>Personalized Area by Campaign</h4>
                </div>

                <div class="result-content col-sm-12">
                    <h4 class="result-header">Result</h4>
                    <div id="in-campaign">
                        <p>You are targeted by <b>"Download demo by registered users"</b> campaign</p>
                        <p>Click the following button simulate <b>"Visit Demo page"</b> interaction in order to engage and end the targeting by the campaign</p>
                        <a id="btn-engage-campaign" class="btn btn-lg btn-info" href="#" role="button"
                           sfdi-trigger="click" sfdi-predicate="Visit" sfdi-object="Demo page">
                            Simulate action
                        </a>
                    </div>
                    <p id="not-in-campaign">You are NOT targeted by <b>"Download demo by registered users"</b> campaign</p>
                </div>
            </div>
        </div>

        <div id="lead" class="by-lead tab-pane fade row">
            <div class="col-sm-12">
                <h4>Use the following buttons to contribute different points to the "Demo" lead scoring</h4>
            </div>
            <div class="col-sm-6">
                <div class="actions">
                    <p>Register Account (1 point):</p>
                    <a id="btn-lead-cold" class="btn btn-lg btn-info" href="#" role="button"
                       sfdi-trigger="click" sfdi-predicate="Register" sfdi-object="Account">
                        Simulate action
                    </a>
                </div>
                <div class="actions">
                    <p>Visit Product page (10 points):</p>
                    <a id="btn-lead-engaged" class="btn btn-lg btn-info" href="#" role="button"
                       sfdi-trigger="click" sfdi-predicate="Visit" sfdi-object="Product page">
                        Simulate action
                    </a>
                </div>
                <div class="actions">
                    <p>Download Product (100 points):</p>
                    <a id="btn-lead-hot" class="btn btn-lg btn-info" href="#" role="button"
                       sfdi-trigger="click" sfdi-predicate="Download file" sfdi-object="Product">
                        Simulate action
                    </a>
                </div>
            </div>

            <div class="col-sm-6">
                <h4>Personalized area by Lead</h4>
                <div class="result-content col-sm-12">
                    <h4 class="result-header">Result</h4>
                    <p id="not-in-lead">You don't match into any of the Leads.</p>
                    <div id="in-lead">
                        <p>Passed: <b><span id="in-lead-threshold"></span> points Level <span id="in-lead-level"></span> threshold</b></p>
                        <p>Score: <b><span id="in-lead-score"></span> points</b></p>
                        <p>Threshold passed at: <b><span id="in-lead-date"></span></b></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script> // Dec client initialization
        var testDataSource = 'QuantumDecDemo';
        var subjectKey = null; // '<please paste the unique guid of the current user or leave as NULL to auto generate one>'
        var decClient = new sfDataIntell.Client({
            apiKey: '0a67e850-b53c-87b1-e5ea-ebe0d980b5e4',
            authToken: 'appauth 8196DA0C-1CCE-F081-A55A-EAD699711529',
            source: testDataSource,
            trackPageVisits: true,
            subjectKey: subjectKey,
            instrument: true
        });
        var subjectMetadata = {
            'FirstName': 'John',
            'LastName': 'Vel',
            'Email': 'john.vel@progress.com'
        };
        decClient.subjectMetadataClient.writeSubjectMetadata(subjectMetadata);
    </script>

    <script>
        $(function () {
            var interval = setInterval(function(){
                checkIsInPersonas();
                checkIsInCampaign();
                checkIsInLeads();
            }, 1000);

            var checkIsInPersonas = function () {
                var doneCallback = function (data, textStatus, jqXHR) {
                    var items = JSON.parse(data.response).items;
                    if (items && items.length) {
                        $('#in-persona').show();
                        $('#not-in-persona').hide();
                    } else {
                        $('#in-persona').hide();
                        $('#not-in-persona').show();
                    }
                };
                var failCallback = function (jqXHR, textStatus, errorThrown) {
                    if (console && console.log) {
                        console.log(jqXHR.responseText);
                    }
                };

                var scoringIds = [47]; // [], Enter the Persona id you want to check. You can check multiple ids or leave it empty in order to check all the Personas
                decClient.personalizationClient.isInPersonas(scoringIds, doneCallback, failCallback, subjectKey);
            };

            var checkIsInCampaign = function () {
                var doneCallback = function (data, textStatus, jqXHR) {
                    var responseIds = JSON.parse(data.response);
                    if (responseIds && responseIds.length) {
                        $.each(responseIds, function (key, value) {
                            if (campaignIds[0] === value) {
                                $('#in-campaign').show();
                                $('#not-in-campaign').hide();
                                return;
                            }
                        });
                    } else {
                        $('#in-campaign').hide();
                        $('#not-in-campaign').show();
                    }
                };
                var failCallback = function (jqXHR, textStatus, errorThrown) {
                    if (console && console.log) {
                        console.log(jqXHR.responseText);
                    }
                };

                var campaignIds = [46]; // '[28, 30]; To check for specific campaigns, type their ids as an array of numbers
                decClient.personalizationClient.isInCampaigns(campaignIds, doneCallback, failCallback);
            };

            var checkIsInLeads = function () {
                var doneCallback = function (data, textStatus, jqXHR) {
                    var items = JSON.parse(data.response).items;
                    if (items && items.length) {
                        for(var i = 0; i < items[0].Levels.length; i += 1){
                            if (items[0].Levels[i].ThresholdPassedOn){
                                $('#in-lead-level').html(i + 1);
                                $('#in-lead-threshold').html(items[0].Levels[i].Threshold);
                                $('#in-lead-date').html(new Date(items[0].Levels[i].ThresholdPassedOn).toDateString());
                                break;
                            }
                        }
                        $('#in-lead-score').html(items[0].Score);

                        $('#not-in-lead').hide();
                        $('#in-lead').show();
                    } else {
                        $('#not-in-lead').show();
                        $('#in-lead').hide();
                    }
                };
                var failCallback = function (jqXHR, textStatus, errorThrown) {
                    if (console && console.log) {
                        console.log(jqXHR.responseText);
                    }
                };

                var scoringIds = [47]; // Enter the lead scoring id you want to check. You can check multiple ids or leave it empty in order to check all the Lead scorings.

                // Deprecated! Do not use!
                // decClient.personalizationClient.isInLeads(scoringIds, contactsDetailsJSON, doneCallback, failCallback);
                decClient.v2.personalizationClient.isInLeads(scoringIds, doneCallback, failCallback, subjectKey);
            };
        });
    </script>

    <footer class="footer">
        <p>&copy; TELERIK 2015 | Narrow Jumbotron Template for Bootstrap</p>
    </footer>

</div> <!-- /container -->

</body>
</html>
